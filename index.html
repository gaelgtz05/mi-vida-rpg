<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Vida RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-color: #0d1117; --main-color: #161b22; --border-color: #30363d;
            --text-color: #c9d1d9; --text-accent-color: #f0f6fc; --accent-color: #388bfd;
            --xp-color: #388bfd; --success-color: #238636; --danger-color: #da3633;
            --warning-color: #f5a623;
        }
        body { font-family: 'Press Start 2P', cursive; background-color: var(--bg-color); color: var(--text-color); text-shadow: 2px 2px #00000060; image-rendering: pixelated; }
        .pixel-box { background-color: var(--main-color); border: 4px solid var(--border-color); box-shadow: 6px 6px 0px #000000; padding: 1.5rem; }
        .pixel-button { background-color: var(--accent-color); border: 4px solid var(--border-color); box-shadow: 4px 4px 0px #000000; padding: 0.75rem 1rem; color: var(--text-accent-color); text-transform: uppercase; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; }
        .pixel-button:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000000; }
        .pixel-button.green { background-color: var(--success-color); } .pixel-button.red { background-color: var(--danger-color); }
        .pixel-button.yellow { background-color: var(--warning-color); color: #000; } .pixel-button.gray { background-color: #484f58; }
        input, textarea { font-family: 'Press Start 2P', cursive; background-color: var(--bg-color); border: 4px solid var(--border-color); padding: 0.75rem; color: var(--text-color); width: 100%; }
        input:focus, textarea:focus { outline: none; border-color: var(--accent-color); }
        .progress-bar-container { background-color: var(--bg-color); border: 2px solid var(--border-color); padding: 4px; }
        .progress-bar { height: 20px; }
        .modal-backdrop { background-color: rgba(0,0,0,0.8); transition: opacity 0.2s; }
        .tab-button { background-color: #484f58; flex-grow: 1; }
        .tab-button.active { background-color: var(--accent-color); transform: none; box-shadow: 4px 4px 0px #000000 inset; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        ::-webkit-scrollbar { width: 16px; } ::-webkit-scrollbar-track { background: var(--bg-color); border-left: 4px solid var(--border-color); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border: 4px solid var(--main-color); }
        .pixel-checkbox { appearance: none; width: 24px; height: 24px; background-color: var(--bg-color); border: 3px solid var(--border-color); cursor: pointer; position: relative; margin-right: 0.75rem; flex-shrink: 0; }
        .pixel-checkbox:checked { background-color: var(--accent-color); border-color: var(--text-accent-color); }
        .pixel-checkbox:checked::after { content: 'X'; color: var(--text-accent-color); position: absolute; font-size: 14px; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .carousel-wrapper { position: relative; }
        .carousel-container { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .carousel-container::-webkit-scrollbar { display: none; }
        .carousel-slide { flex: 0 0 80%; scroll-snap-align: center; margin: 0 10px; }
        @media (min-width: 768px) { .carousel-slide { flex-basis: 40%; } } @media (min-width: 1024px) { .carousel-slide { flex-basis: 30%; } }
        .carousel-nav { display: none; position: absolute; top: 40%; transform: translateY(-50%); width: 100%; justify-content: space-between; pointer-events: none; }
        @media (min-width: 768px) { .carousel-nav { display: flex; } }
        .nav-arrow { pointer-events: all; background-color: rgba(22, 27, 34, 0.7); border: 2px solid var(--border-color); border-radius: 50%; padding: 0.5rem; }
        .item-image { width: 100%; height: 180px; object-fit: contain; background-color: transparent; border: none; transition: filter 0.3s ease-in-out; }
        .item-image.locked { filter: grayscale(1) opacity(0.5); }
        .lock-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; color: var(--text-accent-color); text-shadow: 3px 3px 0px #000; pointer-events: none; }
        input[type="file"] { border: none; padding: 0; }
        input[type="file"]::file-selector-button { font-family: 'Press Start 2P'; background-color: var(--accent-color); border: 2px solid var(--border-color); padding: 0.5rem; color: var(--text-accent-color); cursor: pointer; }
        .item-card-minimal { display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; padding: 1rem 0; }
        .item-card-minimal .item-name { margin-top: 0.5rem; font-size: 0.9rem; }
        .item-card-minimal .item-price { font-size: 0.8rem; }
        .financial-tag { font-size: 0.6rem; padding: 2px 6px; border: 2px solid; margin-bottom: 0.5rem; }
        #start-screen { backdrop-filter: blur(10px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <audio id="background-music" loop></audio>
    <audio id="sfx-player"></audio>

    <div id="app-container" class="hidden">
        <div class="container mx-auto max-w-5xl">
            <header class="pixel-box mb-8">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="text-center md:text-left"><h1 class="text-2xl md:text-3xl text-text-accent-color">MI VIDA RPG</h1></div>
                    <div class="w-full md:w-2/3 space-y-3">
                        <div class="flex items-center gap-2 text-sm"><span class="text-blue-400">PROGRESO:</span><div class="progress-bar-container w-full"><div id="xp-bar" class="progress-bar bg-blue-500"></div></div><span id="xp-text">0%</span></div>
                        <div class="flex items-center gap-2 text-sm"><span class="text-green-400">SALDO:</span><div id="player-balance" class="text-green-400 font-bold">$0.00</div></div>
                    </div>
                    <button id="music-toggle-btn" class="pixel-button !p-2"><i data-lucide="volume-x"></i></button>
                </div>
            </header>

            <nav class="flex flex-wrap gap-2 mb-4">
                <button class="tab-button pixel-button sfx-click active" onclick="showTab('misiones')">Misiones</button>
                <button class="tab-button pixel-button sfx-click" onclick="showTab('finanzas')">Finanzas</button>
                <button class="tab-button pixel-button sfx-click" onclick="showTab('tienda')">Tienda</button>
                <button class="tab-button pixel-button sfx-click" onclick="showTab('inventario')">Inventario</button>
                <button class="tab-button pixel-button sfx-click" onclick="showTab('armario')">Armario</button>
                <button class="tab-button pixel-button sfx-click" onclick="showTab('ajustes')">Ajustes</button>
            </nav>

            <main>
                <div id="misiones-tab" class="tab-content active"><div class="pixel-box">...</div></div>
                <div id="finanzas-tab" class="tab-content"><div class="pixel-box">...</div></div>
                <div id="tienda-tab" class="tab-content"><div class="pixel-box">...</div></div>
                <div id="inventario-tab" class="tab-content"><div class="pixel-box">...</div></div>
                <div id="armario-tab" class="tab-content"><div class="pixel-box">...</div></div>
                <!-- NUEVA PESTAÑA DE AJUSTES -->
                <div id="ajustes-tab" class="tab-content">
                    <div class="pixel-box">
                        <h2 class="text-xl mb-6 text-center text-text-accent-color">AJUSTES DE SONIDO</h2>
                        <div class="space-y-6">
                            <div>
                                <label class="text-lg mb-2 block">Música de Fondo</label>
                                <input type="file" id="music-upload" accept="audio/mp3">
                            </div>
                            <div>
                                <label class="text-lg mb-2 block">Efectos de Sonido</label>
                                <div class="space-y-3 text-sm">
                                    <p>Clic:</p> <input type="file" id="sfx-click-upload" accept="audio/mp3">
                                    <p>Abrir/Navegar:</p> <input type="file" id="sfx-open-upload" accept="audio/mp3">
                                    <p>Confirmar:</p> <input type="file" id="sfx-confirm-upload" accept="audio/mp3">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- PANTALLA DE INICIO -->
    <div id="start-screen" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="text-center">
            <h1 class="text-4xl text-white mb-8">MI VIDA RPG</h1>
            <button id="start-btn" class="pixel-button !text-2xl !p-6">Empezar Aventura</button>
        </div>
    </div>
    
    <!-- MODALES -->
    <!-- ... (sin cambios en la estructura de los modales) ... -->
    <div id="confirm-modal" class="modal-backdrop fixed inset-0 flex items-center justify-center p-4 z-50 hidden"><div class="pixel-box w-full max-w-md text-center"><h3 id="confirm-title" class="text-lg mb-4"></h3><p id="confirm-message" class="mb-6"></p><div class="flex justify-center gap-4"><button id="confirm-cancel-btn" class="pixel-button gray sfx-click"></button><button id="confirm-ok-btn" class="pixel-button sfx-click"></button></div></div></div>


<script>
let state = { 
    balance: 0, 
    missions: [], 
    transactions: [], 
    storeItems: [], 
    wardrobe: { clothes: [], outfits: {} },
    audio: { music: null, sfx: { click: null, open: null, confirm: null } } // NUEVO ESTADO PARA AUDIO
};

const DOM = { 
    appContainer: document.getElementById('app-container'),
    startScreen: document.getElementById('start-screen'),
    startBtn: document.getElementById('start-btn'),
    /* ... (resto de selectores DOM) ... */
    musicToggleBtn: document.getElementById('music-toggle-btn'), 
    bgMusic: document.getElementById('background-music'), 
    sfxPlayer: document.getElementById('sfx-player'),
    confirmModal: { el: document.getElementById('confirm-modal'), title: document.getElementById('confirm-title'), message: document.getElementById('confirm-message'), okBtn: document.getElementById('confirm-ok-btn'), cancelBtn: document.getElementById('confirm-cancel-btn') },
    // NUEVOS SELECTORES PARA UPLOADS
    musicUpload: document.getElementById('music-upload'),
    sfxClickUpload: document.getElementById('sfx-click-upload'),
    sfxOpenUpload: document.getElementById('sfx-open-upload'),
    sfxConfirmUpload: document.getElementById('sfx-confirm-upload')
};

// --- CONFIGURACIÓN DE AUDIO Y FINANZAS ---
const DEFAULT_SFX = {
    click: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_23b3713a86.mp3?filename=select-sound-121244.mp3',
    open: 'https://cdn.pixabay.com/download/audio/2022/03/10/audio_c36c211a7e.mp3?filename=tab-close-sound-112358.mp3',
    confirm: 'https://cdn.pixabay.com/download/audio/2022/01/23/audio_2737a28795.mp3?filename=success_bell-6776.mp3'
};
const DEFAULT_MUSIC_URL = 'https://cdn.pixabay.com/download/audio/2022/11/22/audio_2c0d5257bf.mp3?filename=lofi-beat-126488.mp3';
const INGRESOS = { SENCILLO: 350, AVANZADO: 550 };
const UMBRAL_COMPRA_GRANDE = 0.30;

function saveState() { localStorage.setItem('miVidaRpgState_v8', JSON.stringify(state)); }
function loadState() { const s = localStorage.getItem('miVidaRpgState_v8'); if(s) state = JSON.parse(s); }

function render() { /* ... (sin cambios) ... */ }
function renderStats() { /* ... (sin cambios) ... */ }
function renderMissions() { /* ... (sin cambios) ... */ }
function renderTransactions() { /* ... (sin cambios) ... */ }
function renderStore() {
    const lockSVG = `<svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 1L9 4V8H15V4L12 1Z" /><path fill-rule="evenodd" clip-rule="evenodd" d="M7 9H17V21H7V9ZM5 9C5 7.89543 5.89543 7 7 7H17C18.1046 7 19 7.89543 19 9V21C19 22.1046 18.1046 23 17 23H7C5.89543 23 5 22.1046 5 21V9Z" /></svg>`;
    /* ... (resto del código de renderStore con el nuevo SVG) ... */
}
function renderInventory() { /* ... (sin cambios) ... */ }
function renderWardrobe() { /* ... (sin cambios) ... */ }

// --- LÓGICA DE AUDIO MEJORADA ---
function playSound(type) {
    const soundUrl = state.audio.sfx[type] || DEFAULT_SFX[type];
    if (!soundUrl) return;
    try {
        DOM.sfxPlayer.src = soundUrl;
        DOM.sfxPlayer.play();
    } catch (e) { console.error("Error al reproducir SFX:", e); }
}

function updateMusicSource() {
    DOM.bgMusic.src = state.audio.music || DEFAULT_MUSIC_URL;
}

function toggleMusic() {
    const icon = DOM.musicToggleBtn.querySelector('i');
    if (DOM.bgMusic.paused) {
        DOM.bgMusic.play().catch(e => console.error("Música bloqueada.", e));
        icon.setAttribute('data-lucide', 'volume-2');
    } else {
        DOM.bgMusic.pause();
        icon.setAttribute('data-lucide', 'volume-x');
    }
    lucide.createIcons();
}

function handleFileUpload(file, callback) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        callback(e.target.result);
        saveState();
    };
    reader.readAsDataURL(file);
}

// --- LÓGICA DE LA APP (sin cambios mayores) ---
function addMission() { /* ... */ }
function toggleMission(i) { /* ... */ }
function addTransaction(type) { /* ... */ }
function addStoreItem() { /* ... */ }
function confirmPurchase(index) { /* ... */ }
function buyStoreItem(index) { playSound('confirm'); /* ... */ }

// --- INICIALIZACIÓN Y EVENT LISTENERS ---
function initialize() {
    DOM.startScreen.classList.add('hidden');
    DOM.appContainer.classList.remove('hidden');
    
    updateMusicSource();
    toggleMusic(); // Intenta reproducir la música
    
    // Asigna los listeners para la subida de archivos de audio
    DOM.musicUpload.addEventListener('change', (e) => handleFileUpload(e.target.files[0], (data) => {
        state.audio.music = data;
        updateMusicSource();
        if(!DOM.bgMusic.paused) DOM.bgMusic.play();
    }));
    DOM.sfxClickUpload.addEventListener('change', (e) => handleFileUpload(e.target.files[0], (data) => state.audio.sfx.click = data));
    DOM.sfxOpenUpload.addEventListener('change', (e) => handleFileUpload(e.target.files[0], (data) => state.audio.sfx.open = data));
    DOM.sfxConfirmUpload.addEventListener('change', (e) => handleFileUpload(e.target.files[0], (data) => state.audio.sfx.confirm = data));
    
    // Listener para los botones con SFX
    document.body.addEventListener('click', (e) => {
        if (e.target.closest('.sfx-click')) {
            playSound('click');
        }
    });

    DOM.musicToggleBtn.addEventListener('click', toggleMusic);
}

document.addEventListener('DOMContentLoaded', () => {
    loadState();
    render();
    
    DOM.startBtn.addEventListener('click', initialize, { once: true });
});

// Resto de funciones (showTab, openModal, etc., con llamadas a playSound('open'))
function showTab(tabId) { playSound('open'); /* ... */ }
function openModal(id) { playSound('open'); /* ... */ }

</script>
</body>
</html>

